트랜잭션
--------------------------------
- 앞에서 배웠듯, 트랜잭션이란 "데이터베이스에서 하나의 논리적 작업 단위"를 말합니다.

트랜잭션의 격리 수준(Isolation Level)이 왜 필요할까요?
-------------------------------------------
- 동시에 여러 트랜잭션이 실행되면, 각각의 트랜잭션이 서로 영향을 미치지 않아야 안전하다고 볼 수 있습니다.
- 그래서 격리 수준을 통해 "얼마나 다른 트랜잭션과 격리할 것인가"를 결정합니다.

도서관 책 대여 비유로 이해하는 격리수준
-------------------------------------------
<table>
  <tr>
    <th>격리 수준</th>
    <th>비유</th>
    <th>설명</th>
    <th>대표 문제</th>
  </tr>
  <tr>
    <th>READ UNCOMMITTED</th>
    <td>결제 안 끝난 책도 몰래 읽기</td>
    <td>아직 커밋 안 된 변경도 볼 수 있습니다.</td>
    <td>더티 리드(Dirty Read)</td>
  </tr>
  <tr>
    <th>READ COMMITTED</th>
    <td>결제 완료된 책만 읽기</td>
    <td>커밋된 데이터만 읽을 수 있습니다.</td>
    <td>비반복 읽기(Non-repeatable Read)</td>
  </tr>
  <tr>
    <th>REPEATABLE READ</th>
    <td>읽기 시작하면 책을 잠가둡니다.</td>
    <td>같은 행을 계속 읽을 수 있습니다.</td>
    <td>팬텀 리드(Phantom Read)</td>
  </tr>
  <tr>
    <th>SERIALIZABLE</th>
    <td>아예 서가를 잠궈서 나만 읽습니다.</td>
    <td>완벽한 격리 -> 트랜잭션이 순차 실행되는 것처럼 보이게 합니다.</td>
    <td>성능이 저하되지만, 가장 안전한 방식입니다.</td>
  </tr>
</table>

Locking
---------------------------------------------
- 다른 트랜잭션이 읽거나 수정하지 못하게 잠그는 기술을 Locking이라고 합니다.
- 예를 들어 내가 책을 빌리는 중이라면 다른 사람이 못 읽게 잠그고, 트랜잭션이 끝나야 잠금 해제를 하는 것과 같습니다.

Lock의 종류
------------------------------------
- Shared Lock (S Lock) : 읽을 수는 있지만 수정은 못합니다. ( 읽기는 나눠서 해도 돼. )
- Exclusive Lock (L Lock) : 읽기도 못하고 수정도 못합니다. ( 쓰기는 혼자 해야 해 )

예시 상황으로 정리하는 격리수준
---------------------------------------
- A, B가 동시에 데이터 하나를 읽고 수정하는 상황이라고 해봅시다.

```
1️⃣ READ UNCOMMITTED
A: 값 변경 중 (아직 커밋 안 함)

B: 그 값 읽어버림 😱 → A가 롤백하면 B는 잘못된 값 본 셈

2️⃣ READ COMMITTED
A: 값 변경 중

B: 대기
→ A가 커밋한 이후 값만 읽음 → 안정성 ↑

3️⃣ REPEATABLE READ
B가 읽은 행은 트랜잭션 끝날 때까지 A가 변경 못 함
→ 한 번 읽은 데이터는 계속 동일하게 유지

4️⃣ SERIALIZABLE
B가 읽으려 해도 아예 접근 자체를 막음
→ 모든 트랜잭션이 순차적으로 실행된 것처럼 작동
```

실무에서는 어떤 격리 수준을 사용하면 될까요?
------------------------------------------
- READ COMMITTED : 대부분의 DBMS의 기본값입니다. ( Oracle, PostgreSQL 등... )
- REPEATABLE READ : MySQL의 기본값입니다.
- SERIALIZABLE : 너무 느리기 때문에 보통 잘 사용하지 않습니다.
- READ UNCOMMITED : 위험해서 거의 안 씁니다.

격리 수준 정리
---------------------------------------
- 격리 수준이 높을 수록 안정성은 증가되지만, 성능은 감소하는 반비례 관계를 가집니다.

