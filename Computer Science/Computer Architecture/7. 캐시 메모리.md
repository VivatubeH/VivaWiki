# 컴퓨터구조 수업: 캐시 메모리와 캐시 일관성 문제

## 1. 캐시 메모리란?

### 정의
**캐시 메모리(Cache Memory)**는 CPU와 주기억장치(RAM) 사이에서 속도 차이를 줄이기 위해 사용하는 고속 메모리입니다.

### 핵심 개념
- CPU는 메모리보다 훨씬 빠르기 때문에, 데이터를 가져오려고 RAM만 사용하면 병목이 생깁니다.  
- 이 문제를 해결하기 위해 CPU 내부 혹은 가까운 곳에 있는 빠른 임시 저장소가 바로 캐시 메모리입니다.  
- 자주 사용하는 데이터를 미리 저장해둠으로써, RAM까지 가지 않고 빠르게 접근할 수 있습니다.

### 계층 구조
- **L1 캐시**: 가장 빠르지만 용량 작음 (CPU 코어 안에 있음)  
- **L2 캐시**: 속도는 L1보다 느리지만 더 큼  
- **L3 캐시**: 여러 CPU 코어가 공유, 가장 느리지만 가장 큼

> **TIP**: 캐시는 메모리 접근 속도를 향상시키는 일종의 '복붙 저장소'라고 생각하면 됨.

---

## 2. 캐시 메모리의 원리

### 지역성의 원리 (Principle of Locality)
캐시 메모리는 다음 2가지 지역성의 원리를 기반으로 동작합니다:

- **시간 지역성**: 최근에 사용된 데이터는 다시 사용할 확률이 높음  
- **공간 지역성**: 현재 참조 중인 데이터 근처의 데이터도 곧 사용할 확률이 높음

> 예: 배열을 순차적으로 접근하면 인접한 데이터가 계속 사용되므로 캐시에 담기면 빠르게 처리 가능

---

## 3. 캐시 일관성(Cache Coherence) 문제란?

### 정의
**캐시 일관성 문제**란 여러 개의 캐시가 존재할 때, 하나의 데이터에 대한 복사본들이 서로 다른 값을 가질 수 있는 문제를 의미합니다.

### 왜 문제가 되나?
- 멀티코어 시스템에서는 각 CPU가 자기만의 캐시를 가짐  
- 같은 데이터가 각 캐시에 복사될 수 있음  
- 한 CPU가 데이터를 변경했는데, 다른 CPU 캐시는 그걸 모르면 잘못된 결과가 나올 수 있음

> 예: 여러 사람이 똑같은 문서를 복사해서 갖고 있는데,  
> 한 사람이 문서를 수정해도 다른 사람 복사본에는 반영되지 않음 → 문제 발생

---

## 4. 캐시 일관성 유지 방법

### 1) 쓰기 무효화(Write Invalidate)
- 한 CPU가 데이터를 수정하면, 다른 캐시들의 동일한 데이터를 무효화(invalidate)시킴  
- 다른 CPU는 다시 사용할 때 RAM에서 최신값을 다시 읽어야 함

### 2) 쓰기 갱신(Write Update / Write Broadcast)
- 데이터를 변경하면, 모든 캐시에 그 변경 내용을 전달해서 업데이트

---

## 5. MESI 프로토콜 (대표적인 캐시 일관성 유지 방식)

| 상태 | 의미 |
|------|------|
| **M (Modified)** | 내가 수정했고, RAM에는 최신 정보 없음 |
| **E (Exclusive)** | 내가 가지고 있고, RAM과 내용 동일 |
| **S (Shared)** | 여러 캐시가 공유하고 있고, 내용 동일 |
| **I (Invalid)** | 무효화된 상태 (더 이상 유효하지 않음) |

> 캐시가 변경될 때 상태 전이를 통해 일관성을 유지함

---

## 6. 외우는 방법

### 핵심 키워드 요약
### 외우는 문장
> "캐시는 빠르게! 지역성은 자주! 일관성은 맞춰!  
> 무효화/갱신으로 조율하고, MESI는 상태 바꿔 해결!"

---

## 7. 실습 문제

아래 질문에 대답해보세요:

1. 캐시 메모리를 사용하는 이유는 무엇인가요?  
2. 캐시 일관성 문제가 발생하는 상황을 예시로 설명해보세요.  
3. MESI 프로토콜에서 "M" 상태와 "S" 상태의 차이는 무엇인가요?

<details>
<summary>정답 보기</summary>

1. 메모리 접근 속도를 높이기 위해, CPU와 RAM 간 속도 차이를 줄이려고 사용합니다.  
2. 두 개의 CPU가 같은 데이터를 각자 캐시에 저장하고 있는데, 한 CPU가 데이터를 수정해도 다른 CPU는 그 변경을 모르면 문제 발생  
3. "M"은 내가 데이터를 수정했고 RAM은 구버전, "S"는 여러 캐시가 동일한 최신 데이터를 공유 중

</details>

